"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[7909],{8453(e,n,t){t.d(n,{R:()=>a,x:()=>o});var r=t(6540);const s={},i=r.createContext(s);function a(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(i.Provider,{value:n},e.children)}},8840(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>l,frontMatter:()=>a,metadata:()=>r,toc:()=>m});const r=JSON.parse('{"id":"advanced/custom-storage","title":"Custom Storage","description":"Create your own storage implementation for React Achievements.","source":"@site/advanced/custom-storage.md","sourceDirName":"advanced","slug":"/advanced/custom-storage","permalink":"/react-achievements/docs/advanced/custom-storage","draft":false,"unlisted":false,"editUrl":"https://github.com/dave-b-b/react-achievements/tree/main/docs/advanced/custom-storage.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Common Patterns","permalink":"/react-achievements/docs/recipes/common-patterns"},"next":{"title":"Complex API (POJO Configuration)","permalink":"/react-achievements/docs/advanced/complex-api"}}');var s=t(4848),i=t(8453);const a={sidebar_position:1},o="Custom Storage",c={},m=[{value:"Storage Interface",id:"storage-interface",level:2},{value:"Synchronous Storage Interface",id:"synchronous-storage-interface",level:3},{value:"Asynchronous Storage Interface",id:"asynchronous-storage-interface",level:3},{value:"Example: Custom SessionStorage Implementation",id:"example-custom-sessionstorage-implementation",level:2},{value:"Usage",id:"usage",level:3},{value:"Example: Firebase Storage Implementation",id:"example-firebase-storage-implementation",level:2},{value:"Usage with Async Storage",id:"usage-with-async-storage",level:3},{value:"Example: Supabase Storage",id:"example-supabase-storage",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Handle Errors Gracefully",id:"1-handle-errors-gracefully",level:3},{value:"2. Implement Caching for Async Storage",id:"2-implement-caching-for-async-storage",level:3},{value:"3. Add Migration Support",id:"3-add-migration-support",level:3},{value:"Testing Custom Storage",id:"testing-custom-storage",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"custom-storage",children:"Custom Storage"})}),"\n",(0,s.jsx)(n.p,{children:"Create your own storage implementation for React Achievements."}),"\n",(0,s.jsx)(n.h2,{id:"storage-interface",children:"Storage Interface"}),"\n",(0,s.jsxs)(n.p,{children:["To create a custom storage backend, implement either the synchronous ",(0,s.jsx)(n.code,{children:"AchievementStorage"})," interface or the asynchronous ",(0,s.jsx)(n.code,{children:"AsyncAchievementStorage"})," interface."]}),"\n",(0,s.jsx)(n.h3,{id:"synchronous-storage-interface",children:"Synchronous Storage Interface"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface AchievementStorage {\n  getMetrics(): AchievementMetrics;\n  setMetrics(metrics: AchievementMetrics): void;\n  getUnlockedAchievements(): string[];\n  setUnlockedAchievements(achievements: string[]): void;\n  clear(): void;\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"asynchronous-storage-interface",children:"Asynchronous Storage Interface"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface AsyncAchievementStorage {\n  getMetrics(): Promise<AchievementMetrics>;\n  setMetrics(metrics: AchievementMetrics): Promise<void>;\n  getUnlockedAchievements(): Promise<string[]>;\n  setUnlockedAchievements(achievements: string[]): Promise<void>;\n  clear(): Promise<void>;\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"example-custom-sessionstorage-implementation",children:"Example: Custom SessionStorage Implementation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { AchievementStorage, AchievementMetrics } from 'react-achievements';\n\nexport class SessionStorageAdapter implements AchievementStorage {\n  private keyPrefix: string;\n\n  constructor(keyPrefix = 'achievements') {\n    this.keyPrefix = keyPrefix;\n  }\n\n  private getKey(key: string): string {\n    return `${this.keyPrefix}_${key}`;\n  }\n\n  getMetrics(): AchievementMetrics {\n    const data = sessionStorage.getItem(this.getKey('metrics'));\n    return data ? JSON.parse(data) : {};\n  }\n\n  setMetrics(metrics: AchievementMetrics): void {\n    sessionStorage.setItem(\n      this.getKey('metrics'),\n      JSON.stringify(metrics)\n    );\n  }\n\n  getUnlockedAchievements(): string[] {\n    const data = sessionStorage.getItem(this.getKey('unlocked'));\n    return data ? JSON.parse(data) : [];\n  }\n\n  setUnlockedAchievements(achievements: string[]): void {\n    sessionStorage.setItem(\n      this.getKey('unlocked'),\n      JSON.stringify(achievements)\n    );\n  }\n\n  clear(): void {\n    sessionStorage.removeItem(this.getKey('metrics'));\n    sessionStorage.removeItem(this.getKey('unlocked'));\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"usage",children:"Usage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"import { AchievementProvider } from 'react-achievements';\nimport { SessionStorageAdapter } from './SessionStorageAdapter';\n\nconst sessionStorage = new SessionStorageAdapter();\n\nfunction App() {\n  return (\n    <AchievementProvider\n      achievements={gameAchievements}\n      storage={sessionStorage}\n    >\n      {/* Your app */}\n    </AchievementProvider>\n  );\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"example-firebase-storage-implementation",children:"Example: Firebase Storage Implementation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { AsyncAchievementStorage, AchievementMetrics } from 'react-achievements';\nimport { getFirestore, doc, setDoc, getDoc } from 'firebase/firestore';\n\nexport class FirebaseStorage implements AsyncAchievementStorage {\n  private db;\n  private userId: string;\n\n  constructor(userId: string) {\n    this.db = getFirestore();\n    this.userId = userId;\n  }\n\n  private get docRef() {\n    return doc(this.db, 'achievements', this.userId);\n  }\n\n  async getMetrics(): Promise<AchievementMetrics> {\n    const snapshot = await getDoc(this.docRef);\n    return snapshot.data()?.metrics || {};\n  }\n\n  async setMetrics(metrics: AchievementMetrics): Promise<void> {\n    await setDoc(this.docRef, { metrics }, { merge: true });\n  }\n\n  async getUnlockedAchievements(): Promise<string[]> {\n    const snapshot = await getDoc(this.docRef);\n    return snapshot.data()?.unlocked || [];\n  }\n\n  async setUnlockedAchievements(achievements: string[]): Promise<void> {\n    await setDoc(this.docRef, { unlocked: achievements }, { merge: true });\n  }\n\n  async clear(): Promise<void> {\n    await setDoc(this.docRef, { metrics: {}, unlocked: [] });\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"usage-with-async-storage",children:"Usage with Async Storage"}),"\n",(0,s.jsxs)(n.p,{children:["Async storage is automatically wrapped with the ",(0,s.jsx)(n.code,{children:"AsyncStorageAdapter"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"import { AchievementProvider } from 'react-achievements';\nimport { FirebaseStorage } from './FirebaseStorage';\n\nconst firebaseStorage = new FirebaseStorage('user123');\n\nfunction App() {\n  return (\n    <AchievementProvider\n      achievements={gameAchievements}\n      storage={firebaseStorage}\n    >\n      {/* Your app */}\n    </AchievementProvider>\n  );\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"The provider automatically detects async storage and wraps it with optimistic updates."}),"\n",(0,s.jsx)(n.h2,{id:"example-supabase-storage",children:"Example: Supabase Storage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { AsyncAchievementStorage, AchievementMetrics } from 'react-achievements';\nimport { createClient, SupabaseClient } from '@supabase/supabase-js';\n\nexport class SupabaseStorage implements AsyncAchievementStorage {\n  private supabase: SupabaseClient;\n  private userId: string;\n\n  constructor(supabaseUrl: string, supabaseKey: string, userId: string) {\n    this.supabase = createClient(supabaseUrl, supabaseKey);\n    this.userId = userId;\n  }\n\n  async getMetrics(): Promise<AchievementMetrics> {\n    const { data, error } = await this.supabase\n      .from('achievements')\n      .select('metrics')\n      .eq('user_id', this.userId)\n      .single();\n\n    if (error || !data) return {};\n    return data.metrics;\n  }\n\n  async setMetrics(metrics: AchievementMetrics): Promise<void> {\n    await this.supabase\n      .from('achievements')\n      .upsert({\n        user_id: this.userId,\n        metrics,\n        updated_at: new Date().toISOString(),\n      });\n  }\n\n  async getUnlockedAchievements(): Promise<string[]> {\n    const { data, error } = await this.supabase\n      .from('achievements')\n      .select('unlocked')\n      .eq('user_id', this.userId)\n      .single();\n\n    if (error || !data) return [];\n    return data.unlocked;\n  }\n\n  async setUnlockedAchievements(achievements: string[]): Promise<void> {\n    await this.supabase\n      .from('achievements')\n      .upsert({\n        user_id: this.userId,\n        unlocked: achievements,\n        updated_at: new Date().toISOString(),\n      });\n  }\n\n  async clear(): Promise<void> {\n    await this.supabase\n      .from('achievements')\n      .delete()\n      .eq('user_id', this.userId);\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"1-handle-errors-gracefully",children:"1. Handle Errors Gracefully"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"async getMetrics(): Promise<AchievementMetrics> {\n  try {\n    const response = await fetch(`${this.apiUrl}/metrics`);\n    if (!response.ok) {\n      console.error('Failed to fetch metrics');\n      return {}; // Return empty metrics on error\n    }\n    return await response.json();\n  } catch (error) {\n    console.error('Error fetching metrics:', error);\n    return {};\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-implement-caching-for-async-storage",children:"2. Implement Caching for Async Storage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export class CachedStorage implements AsyncAchievementStorage {\n  private cache: { metrics?: AchievementMetrics; unlocked?: string[] } = {};\n  private underlyingStorage: AsyncAchievementStorage;\n\n  constructor(storage: AsyncAchievementStorage) {\n    this.underlyingStorage = storage;\n  }\n\n  async getMetrics(): Promise<AchievementMetrics> {\n    if (!this.cache.metrics) {\n      this.cache.metrics = await this.underlyingStorage.getMetrics();\n    }\n    return this.cache.metrics;\n  }\n\n  async setMetrics(metrics: AchievementMetrics): Promise<void> {\n    this.cache.metrics = metrics;\n    await this.underlyingStorage.setMetrics(metrics);\n  }\n\n  // ... implement other methods similarly\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-add-migration-support",children:"3. Add Migration Support"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export class MigratableStorage implements AchievementStorage {\n  private version = 2;\n  private keyPrefix: string;\n\n  constructor(keyPrefix = 'achievements') {\n    this.keyPrefix = keyPrefix;\n    this.migrateIfNeeded();\n  }\n\n  private migrateIfNeeded(): void {\n    const currentVersion = localStorage.getItem(`${this.keyPrefix}_version`);\n\n    if (!currentVersion || parseInt(currentVersion) < this.version) {\n      this.migrate(parseInt(currentVersion || '0'));\n      localStorage.setItem(`${this.keyPrefix}_version`, String(this.version));\n    }\n  }\n\n  private migrate(fromVersion: number): void {\n    if (fromVersion < 2) {\n      // Migrate data from version 1 to version 2\n      // ... migration logic\n    }\n  }\n\n  // ... implement storage interface\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"testing-custom-storage",children:"Testing Custom Storage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { render } from '@testing-library/react';\nimport { AchievementProvider } from 'react-achievements';\nimport { MyCustomStorage } from './MyCustomStorage';\n\ndescribe('MyCustomStorage', () => {\n  it('should store and retrieve metrics', () => {\n    const storage = new MyCustomStorage();\n    const metrics = { score: [100] };\n\n    storage.setMetrics(metrics);\n    const retrieved = storage.getMetrics();\n\n    expect(retrieved).toEqual(metrics);\n  });\n\n  it('should work with AchievementProvider', () => {\n    const storage = new MyCustomStorage();\n\n    render(\n      <AchievementProvider\n        achievements={testAchievements}\n        storage={storage}\n      >\n        <TestComponent />\n      </AchievementProvider>\n    );\n\n    // ... test your component\n  });\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"/docs/guides/storage-options",children:"Storage Options"})})," - Built-in storage types"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"/docs/api-intro",children:"API Reference"})})," - Complete type definitions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"/docs/guides/error-handling",children:"Error Handling"})})," - Handle storage errors"]}),"\n"]})]})}function l(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);